<lib-page-content [title]="'stockIn.TaxList' | translate" [subTitle]="'stockIn.TaxList' | translate">

<div [formGroup]="stockInForm" class="stockInForm_header">
  <div class="grid">
    <div class="md:col-2 my-2">
      <lib-label [appControl]="stockInForm.controls['code']">
        {{ 'stockIn.code' | translate }}
      </lib-label>
      <lib-text-input
        placeholder="{{ 'stockIn.code' | translate }}"
        formControlName="code"
        [readOnly]="true"
      ></lib-text-input>
      <lib-field-validations [appControl]="stockInForm.controls['code']"></lib-field-validations>
    </div>
    <div class="md:col-2 my-2">
      <lib-label [appControl]="stockInForm.controls['receiptDate']">
        {{ 'stockIn.date' | translate }}
      </lib-label>
      <lib-calendar formControlName="receiptDate"></lib-calendar>
      <lib-field-validations [appControl]="stockInForm.controls['receiptDate']"></lib-field-validations>
    </div>

    <div class="md:col-2 my-2">
      <lib-label [appControl]="stockInForm.controls['sourceDocumentType']">
        {{ 'stockIn.docType' | translate }}
      </lib-label>
      <lib-select
        formControlName="sourceDocumentType"
        [options]="lookups[LookupEnum.StockInOutSourceDocumentType]!"
        optionValue="id"
        optionLabel="name"
        [selectedValue]="stockInForm.controls['sourceDocumentType'].value"
      >
      </lib-select>
      <lib-field-validations [appControl]="stockInForm.controls['sourceDocumentType']"></lib-field-validations>
    </div>
    <div class="md:col-3 my-2">
      <lib-label [appControl]="stockInForm.controls['sourceDocumentId']">
        {{ 'stockIn.sourceDoc' | translate }}
      </lib-label>
      <lib-select
        formControlName="sourceDocumentId"
        [options]="oprationalLookup"
        optionValue="id"
        optionLabel="name"
        placeholder="{{ 'stockIn.sourceDoc' | translate }}"
        [selectedValue]="stockInForm.controls['sourceDocumentId'].value"
      >
      </lib-select>
      <lib-field-validations [appControl]="stockInForm.controls['sourceDocumentId']"></lib-field-validations>
    </div>
    <div class="md:col-3 my-2">
      <lib-label [appControl]="stockInForm.controls['warehouseId']">
        {{ 'stockIn.warehouse' | translate }}
      </lib-label>
      <lib-select
        formControlName="warehouseId"
        [options]="warhouseLookupData"
        optionValue="id"
        optionLabel="name"
        placeholder="{{ 'stockIn.warehouse' | translate }}"
        [selectedValue]="stockInForm.controls['warehouseId'].value"
      >
      </lib-select>
      <lib-field-validations [appControl]="stockInForm.controls['warehouseId']"></lib-field-validations>
    </div>
    <div class="md:col-6 my-2">
      <div>
        <lib-label [appControl]="stockInForm.controls['notes']">
          {{ 'stockIn.notes' | translate }}
        </lib-label>
      </div>

      <textarea
        pInputTextarea
        style="width: 100%"
        rows="1"
        formControlName="notes"
        placeholder="{{ 'stockIn.notes' | translate }}"
      ></textarea>
    </div>
  </div>
</div>

<div class="flex justify-content-end gap-4">
  <lib-button-micro [title]="'stockIn.uploadExcel'|translate" nameClass="outline"
  iconName="pi pi-file-edit" (click)="getExcel()">
</lib-button-micro>
  <lib-button-micro [title]="'stockIn.scan'|translate" nameClass="outline"
              iconName="pi pi-expand" (click)="scan()">
            </lib-button-micro>
 
</div>

<div class="my-2">
  <p-table
    [value]="stockIn['controls']"
    dataKey="id"
    styleClass="p-datatable-gridlines p-datatable-striped"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>{{ 'stockIn.barcode' | translate }}</th>
        <th>{{ 'stockIn.itemCode' | translate }}</th>
        <th>{{ 'stockIn.itemDescription' | translate }}</th>
        <th>{{ 'stockIn.UOM' | translate }}</th>
        <th>{{ 'stockIn.QTY' | translate }}</th>
        <th>{{ 'stockIn.cost' | translate }}</th>
        <th>{{ 'stockIn.subTotal' | translate }}</th>
        <th>{{ 'stockIn.tracking' | translate }}</th>
        <th>{{ 'stockIn.note' | translate }}</th>
        <th>{{ 'stockIn.actions' | translate }}</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-stockInFormGroup let-editing="editing" let-i="rowIndex">
      <tr [formGroup]="stockInFormGroup">
        <td [pEditableColumn]="stockInFormGroup.controls['barCode']" pEditableColumnField="barCode">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.barcode' | translate }}"
                formControlName="barCode"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['barCode']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['barCode']"
          ></lib-field-validations>
        </td>
        <!--  -->

        <td [pEditableColumn]="stockInFormGroup.controls['itemId']" pEditableColumnField="itemId">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <div class="flex justify-content-center gap-2 align-items-center">
                <lib-select
                formControlName="itemId"
                [options]="latestItemsList"
                optionValue="itemId"
                optionLabel="displayName"
                placeholder="{{ 'stockIn.itemCode' | translate }}"
                (valueChanged)="itemChanged($event , stockInFormGroup)"
              >
              </lib-select>
              <i class="pi pi-search search-circle" (click)="openDialog(stockInFormGroup)"></i>
              </div>
            

            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['itemCodeName']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['itemId']"
          ></lib-field-validations>
        </td>
        <!--  -->
        <td [pEditableColumn]="stockInFormGroup.controls['description']" pEditableColumnField="description">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.itemDescription' | translate }}"
                formControlName="description"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['description']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['description']"
          ></lib-field-validations>
        </td>
        <!--  -->
        <!--  -->

        <td [pEditableColumn]="stockInFormGroup.controls['uomId']" pEditableColumnField="uomId">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-select
                formControlName="uomId"
                [options]="uomLookup"
                optionValue="uomId"
                [optionLabel]="currentLang == 'en' ? 'uomNameEn' : 'uomNameAr'"
                placeholder="{{ 'stockIn.UOM' | translate }}"
                (valueChanged)="uomChanged($event, stockInFormGroup)"
              ></lib-select>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['uomName']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['uomId']"
          ></lib-field-validations>
        </td>
        <!--  -->

        <td [pEditableColumn]="stockInFormGroup.controls['quantity']" pEditableColumnField="quantity">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.QTY' | translate }}"
                formControlName="quantity"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['quantity']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['quantity']"
          ></lib-field-validations>
        </td>
        <!--  -->

        <td [pEditableColumn]="stockInFormGroup.controls['cost']" pEditableColumnField="cost">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.cost' | translate }}"
                formControlName="cost"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['cost']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['cost']"
          ></lib-field-validations>
        </td>
        <!--  -->
        <td [pEditableColumn]="stockInFormGroup.controls['subTotal']" pEditableColumnField="subTotal">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.subTotal' | translate }}"
                formControlName="subTotal"
                [readOnly]="true"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['quantity']?.value *  stockInFormGroup.controls['cost']?.value}}
            </ng-template>
          </p-cellEditor>
        
        </td>
        <!--  -->
        <td  >
          
              <div class="flex align-content-center gap-3 align-items-center">
                <small class="track" *ngIf="stockInFormGroup.get('trackingType').value == sharedFinanceEnums.trackingType.NoTracking && stockInFormGroup.get('hasExpiryDate')?.value == true">
                  {{stockInFormGroup.get('stockInTracking').get('expireDate')?.value |  date : "dd-MM-yyyy"}}
                </small>
                <!--  -->
                <small class="track" *ngIf="stockInFormGroup.get('trackingType').value == sharedFinanceEnums.trackingType.Serial">{{stockInFormGroup.get('stockInTracking').get('serialId')?.value}}</small>
                <!--  -->
                <small class="track" *ngIf="stockInFormGroup.get('trackingType').value == sharedFinanceEnums.trackingType.Batch">{{stockInFormGroup.get('stockInTracking').get('vendorBatchNo')?.value}}</small>

                <lib-button-micro
                title="{{ 'stockIn.setTracking' | translate }}"
                nameClass="save"
                widthNumber="100%" 
                (click)="setTracking(stockInFormGroup)"
                [disabled]="stockInFormGroup.get('trackingType').value == sharedFinanceEnums.trackingType.NoTracking && stockInFormGroup.get('hasExpiryDate')?.value == false || !stockInFormGroup.get('itemId').value"
              >
              </lib-button-micro>
              </div>
               
        
        </td>
        <!--  -->
        <td [pEditableColumn]="stockInFormGroup.controls['notes']" pEditableColumnField="notes">
          <p-cellEditor>
            <ng-template pTemplate="input">
              <lib-text-input
                placeholder="{{ 'stockIn.note' | translate }}"
                formControlName="notes"
              ></lib-text-input>
            </ng-template>
            <ng-template pTemplate="output">
              {{ stockInFormGroup.controls['notes']?.value }}
            </ng-template>
          </p-cellEditor>
          <lib-field-validations
            [appControl]="stockInFormGroup.controls['notes']"
          ></lib-field-validations>
        </td>
        <td>
          <div class="flex gap-3">
            <img src="assets/images/table/edit.svg pointer" alt="" (click)="onEdit(stockInFormGroup)" />
            <img src="assets/images/table/delete.svg pointer" alt="" (click)="OnDelete(i)" />

          </div>
        </td>
        <!--  -->
      </tr>
    </ng-template>
  </p-table>
  <div class="add_new  flex justify-content-start">
    <lib-button (onClick)="addLineStockIn()" className="outline-primary">
      {{ 'itemType.add_new' | translate }}
    </lib-button>
  </div>
</div>

<div class="grid">
  <div class="md:col-12 my-3 grid flex justify-content-end">
    <div class="md:col-4 grid flex justify-content-end">
      <div class="md:col-6">
        <lib-button-micro
          title="{{ 'cancel' | translate }}"
          nameClass="cancel"
          widthNumber="100%"
          (click)="onCancel()"
        >
        </lib-button-micro>
      </div>
      <div class="md:col-6">
        <lib-button-micro
          title="{{ 'Save' | translate }}"
          nameClass="save"
          widthNumber="100%"
          (click)="onSave()"
        >
        </lib-button-micro>
      </div>
    </div>
  </div>
</div>
</lib-page-content>
