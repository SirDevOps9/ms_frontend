<lib-page-content [title]="'stockIn.TaxList' | translate" [subTitle]="'stockIn.TaxList' | translate">

  <div [formGroup]="stockOutForm" class="grid my w-100 card stockInForm_header">
    <div class="grid md:col-12 p-1 m-0">
      <div class="md:col-2 my-2">
        <lib-label [appControl]="stockOutForm.controls['code']">
          {{ 'stockIn.code' | translate }}
        </lib-label>
        <lib-text-input
          placeholder="{{ 'stockIn.code' | translate }}"
          formControlName="code"
          [readOnly]="true"
        ></lib-text-input>
        <lib-field-validations [appControl]="stockOutForm.controls['code']"></lib-field-validations>
      </div>
      <div class="md:col-2 my-2">
        <lib-label [appControl]="stockOutForm.controls['receiptDate']">
          {{ 'stockIn.date' | translate }}
        </lib-label>


          <lib-calendar style="height: 45px !important;" formControlName="receiptDate"></lib-calendar>

          <lib-field-validations  [appControl]="stockOutForm.controls['receiptDate']"></lib-field-validations>

      </div>

      <div class="md:col-3 my-2">
        <lib-label [appControl]="stockOutForm.controls['sourceDocumentId']">
          {{ 'stockIn.sourceDoc' | translate }}
        </lib-label>
        <lib-select
          formControlName="sourceDocumentId"
          [options]="oprationalLookup"
          optionValue="id"
          optionLabel="name"
          placeholder="{{ 'stockIn.sourceDoc' | translate }}"
          [selectedValue]="stockOutForm.controls['sourceDocumentId'].value"
        >
        </lib-select>
        <lib-field-validations [appControl]="stockOutForm.controls['sourceDocumentId']"></lib-field-validations>
      </div>

      <div class="md:col-2 my-2">
        <lib-label [appControl]="stockOutForm.controls['sourceDocumentType']">
          {{ 'stockIn.docType' | translate }}
        </lib-label>
        <lib-select
          formControlName="sourceDocumentType"
          [options]="lookups[LookupEnum.StockInOutSourceDocumentType]!"
          optionValue="id"
          optionLabel="name"
          [selectedValue]="stockOutForm.controls['sourceDocumentType'].value"
        >
        </lib-select>
        <lib-field-validations [appControl]="stockOutForm.controls['sourceDocumentType']"></lib-field-validations>
      </div>
      <div class="md:col-3 my-2">
        <lib-label [appControl]="stockOutForm.controls['warehouseId']">
          {{ 'stockIn.warehouse' | translate }}
        </lib-label>
        <lib-select
          formControlName="warehouseId"
          [options]="dataHousesDropDown"
          optionValue="id"
          optionLabel="name"
          placeholder="{{ 'stockIn.warehouse' | translate }}"
          [selectedValue]="stockOutForm.controls['warehouseId'].value"
        >
        </lib-select>
        <lib-field-validations [appControl]="stockOutForm.controls['warehouseId']"></lib-field-validations>
      </div>
      <div class="md:col-6 my-2">
        <div>
          <lib-label [appControl]="stockOutForm.controls['notes']">
            {{ 'stockIn.notes' | translate }}
          </lib-label>
        </div>

        <textarea
          pInputTextarea
          style="width: 100%"
          rows="3"
          cols="5"
          formControlName="notes"
          placeholder="{{ 'stockIn.notes' | translate }}"
        ></textarea>
      </div>
    </div>
  </div>

  <div class="my-2">
    <p-table
      [value]="stockOut['controls']"
      dataKey="id"
      styleClass="p-datatable-gridlines p-datatable-striped"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>{{ 'stockIn.barcode' | translate }}</th>
          <th>{{ 'stockIn.itemCode' | translate }}</th>
          <th>{{ 'stockIn.itemDescription' | translate }}</th>
          <th>{{ 'stockIn.UOM' | translate }}</th>
          <th>{{ 'stockIn.QTY' | translate }}</th>
          <th>{{ 'stockIn.cost' | translate }}</th>
          <th>{{ 'stockIn.subTotal' | translate }}</th>
          <th>{{ 'stockIn.tracking' | translate }}</th>
          <th>{{ 'stockIn.note' | translate }}</th>
          <th>{{ 'stockIn.actions' | translate }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-stockOutForm let-editing="editing" let-i="rowIndex">
        <tr [formGroup]="stockOutForm">
          <td [pEditableColumn]="stockOutForm.controls['barcode']" pEditableColumnField="barcode">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.barcode' | translate }}"
                  formControlName="barcode"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['barcode']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['barcode']"
            ></lib-field-validations>
          </td>
          <!--  -->

          <td [pEditableColumn]="stockOutForm.controls['itemId']" pEditableColumnField="itemId">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div class="flex justify-content-center gap-2 align-items-center">
                  <lib-select
                  formControlName="itemId"
                  [options]="latestItemsList"
                  optionValue="itemId"
                  optionLabel="displayName"
                  placeholder="{{ 'stockIn.itemCode' | translate }}"
                  (valueChanged)="itemChanged($event , stockOutForm)"
                >
                </lib-select>
                <i class="pi pi-search search-circle" (click)="openDialog(stockOutForm)"></i>
                </div>


              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['itemCodeName']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['itemId']"
            ></lib-field-validations>
          </td>
          <!--  -->
          <td [pEditableColumn]="stockOutForm.controls['description']" pEditableColumnField="description">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.itemDescription' | translate }}"
                  formControlName="description"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['description']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['description']"
            ></lib-field-validations>
          </td>
          <!--  -->
          <!--  -->

          <td [pEditableColumn]="stockOutForm.controls['uomId']" pEditableColumnField="uomId">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-select
                  formControlName="uomId"
                  [options]="uomLookup"
                  optionValue="uomId"
                  [optionLabel]="currentLang == 'en' ? 'uomNameEn' : 'uomNameAr'"
                  placeholder="{{ 'stockIn.UOM' | translate }}"
                  (valueChanged)="uomChanged($event, stockOutForm)"
                ></lib-select>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['uomName']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['uomId']"
            ></lib-field-validations>
          </td>

          <!--  -->

          <td [pEditableColumn]="stockOutForm.controls['quantity']" pEditableColumnField="quantity">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.QTY' | translate }}"
                  formControlName="quantity"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['quantity']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['quantity']"
            ></lib-field-validations>
          </td>
          <!--  -->

          <td [pEditableColumn]="stockOutForm.controls['cost']" pEditableColumnField="cost">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.cost' | translate }}"
                  formControlName="cost"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['cost']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['cost']"
            ></lib-field-validations>
          </td>
          <!--  -->
          <td [pEditableColumn]="stockOutForm.controls['subTotal']" pEditableColumnField="subTotal">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.subTotal' | translate }}"
                  formControlName="subTotal"
                  [readOnly]="true"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['quantity']?.value *  stockOutForm.controls['cost']?.value}}
              </ng-template>
            </p-cellEditor>

          </td>
          <!--  -->
          <td [pEditableColumn]="stockOutForm.controls['trackingType']" pEditableColumnField="trackingType">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.tracking' | translate }}"
                  formControlName="trackingType"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['trackingType']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['trackingType']"
            ></lib-field-validations>
          </td>
          <!--  -->
          <td [pEditableColumn]="stockOutForm.controls['notes']" pEditableColumnField="notes">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <lib-text-input
                  placeholder="{{ 'stockIn.note' | translate }}"
                  formControlName="notes"
                ></lib-text-input>
              </ng-template>
              <ng-template pTemplate="output">
                {{ stockOutForm.controls['notes']?.value }}
              </ng-template>
            </p-cellEditor>
            <lib-field-validations
              [appControl]="stockOutForm.controls['notes']"
            ></lib-field-validations>
          </td>
          <td>
            <img src="assets/images/table/delete.svg" alt="" (click)="OnDelete(i)" />

          </td>
          <!--  -->
        </tr>
      </ng-template>
    </p-table>
    <div class="add_new  flex justify-content-start">
      <lib-button (onClick)="addLineStockIn()" className="outline-primary">
        {{ 'itemType.add_new' | translate }}
      </lib-button>
    </div>
  </div>

  <div class="grid">
    <div class="md:col-12 my-3 grid flex justify-content-end">
      <div class="md:col-4 grid flex justify-content-end">
        <div class="md:col-6">
          <lib-button-micro
            title="{{ 'cancel' | translate }}"
            nameClass="cancel"
            widthNumber="100%"
            (click)="onCancel()"
          >
          </lib-button-micro>
        </div>
        <div class="md:col-6">
          <lib-button-micro
            title="{{ 'Save' | translate }}"
            nameClass="save"
            widthNumber="100%"
            (click)="onSave()"
          >
          </lib-button-micro>
        </div>
      </div>
    </div>
  </div>
  </lib-page-content>
