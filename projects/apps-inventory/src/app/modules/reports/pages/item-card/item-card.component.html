<lib-page-content>
  <div class="user_page">
    <div class="card_micro">
      <form [formGroup]="moreInfoForm">
        <div class="group">
          <div class="grid">
            <div class="col-12 md:col-3">
              <lib-form-group>
                <lib-label [appControl]="moreInfoForm.controls['warehouseId']">
                  {{ 'popupSearch.ItemCode' | translate }}
                </lib-label>
                <div class="grid justify-content-start align-items-center gap-1">
                  <div class="col-10">
                    <lib-select
                      formControlName="itemId"
                      [options]="filteredItems"
                      optionValue="itemId"
                      optionLabel="displayName"
                      (valueChanged)="setRowData($event, filteredItems)"
                      (valueSearchChanged)="onFilter($event, 'warehouseId')"
                    >
                    </lib-select>
                  </div>
                  <i class="pi pi-search search-circle col-1" (click)="openDialog()"></i>
                </div>
              </lib-form-group>
              <lib-field-validations [appControl]="moreInfoForm.controls['itemId']">
              </lib-field-validations>
            </div>
            <div class="col-12 md:col-3">
              <lib-form-group>
                <lib-label [appControl]="moreInfoForm.controls['itemName']">
                  {{ 'popupSearch.ItemName' | translate }}
                </lib-label>

                <lib-text-input
                  placeholder="{{ 'popupSearch.ItemName' | translate }}"
                  [readOnly]="true"
                  formControlName="itemName"
                ></lib-text-input>
              </lib-form-group>
              <lib-field-validations [appControl]="moreInfoForm.controls['warehouseId']">
              </lib-field-validations>
            </div>
            <div class="col-12 md:col-3">
              <lib-form-group>
                <lib-label [appControl]="moreInfoForm.controls['itemVariantName']">
                  {{ 'popupSearch.ItemVariant' | translate }}
                </lib-label>

                <lib-text-input
                  placeholder="{{ 'popupSearch.ItemVariant' | translate }}"
                  [readOnly]="true"
                  formControlName="itemVariantName"
                ></lib-text-input>
              </lib-form-group>
              <lib-field-validations [appControl]="moreInfoForm.controls['itemVariantName']">
              </lib-field-validations>
            </div>

            <div class="col-12 md:col-3">
              <lib-form-group>
                <lib-label [appControl]="moreInfoForm.controls['warehouseId']">
                  {{ 'OperationalTag.warehouseName' | translate }}
                </lib-label>
                <lib-select
                  formControlName="warehouseId"
                  [options]="warehouseLookupData"
                  [selectedValue]="moreInfoForm.controls['warehouseId'].value"
                  optionLabel="name"
                  optionValue="id"
                  placeholder="{{ 'OperationalTag.warehouseName' | translate }}"
                >
                </lib-select>
              </lib-form-group>
              <lib-field-validations [appControl]="moreInfoForm.controls['warehouseId']">
              </lib-field-validations>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="flex gap-2 justify-content-end my-3">
      <lib-button-micro
        [title]="'itemCardReport.view' | translate"
        [nameClass]="itemTransactionForm.valid ? 'save' : 'disabled'"
        iconName="pi pi-circle"
        [ngClass]="{ disabled: !itemTransactionForm.valid }"
        (click)="viewItemTransaction()"
      >
      </lib-button-micro>
      <button class="btn_ex" (click)="printTable('printableTable')">
        <span class="pi pi-print"></span>
      </button>
    </div>

    @for( warehouseTransaction of warehousesTransactionsTables ; track warehouseTransaction) {
    <div class="card_micro">
      <lib-data-table
        [resizableColumns]="false"
        [items]="warehouseTransaction.transactions"
        className="p-datatable-gridlines"
        [reportTable]="true"
        [noColumnFilter]="false"
        [tableConfigs]="{
            allowPagination: false,
            allowServerPagination: false,
            dataKey: 'id',
            pageSize: 10,
            columns: [
              {
                name: 'transactionName',
                headerText: ('itemCardReport.transactionName' | translate),
                rowspan: '3',
                class: 'center'
              },
              {
                name: 'transactionCode',
                headerText: ('itemCardReport.transactionCode' | translate),
                rowspan: '3',
                class: 'center',
              },
              {
                name: 'serial',
                headerText: ('itemCardReport.serial' | translate),
                rowspan: '3',
                class: 'center',
              },
              {
                name: 'batchNumber',
                headerText: ('itemCardReport.batchNo' | translate),
                rowspan: '3',
                class: 'center',
              },
              {
                name: 'expiryDate',
                headerText: ('itemCardReport.expiryDate' | translate),
                rowspan: '3',
                class: 'center',
              },
              {
                name: 'in',
                headerText: ('itemCardReport.in' | translate),
                colspan: '3',
                class: 'left_Balance center',
                children: [
                  {
                    name: 'qty',
                    headerText: ('itemCardReport.subTitles.QTY' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },
                  {
                    name: 'cost',
                    headerText: ('itemCardReport.subTitles.cost' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },
                  {
                    name: 'total',
                    headerText: ('itemCardReport.subTitles.subTotal' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },

                ]
              },
              {
                name: 'out',
                headerText: ('itemCardReport.out' | translate),
                colspan: '3',
                class: 'left_Balance center',
                children: [
                {
                    name: 'qty',
                    headerText: ('itemCardReport.subTitles.QTY' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },
                  {
                    name: 'cost',
                    headerText: ('itemCardReport.subTitles.cost' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },
                  {
                    name: 'total',
                    headerText: ('itemCardReport.subTitles.subTotal' | translate),
                    class: ' left_Balance debit center',
                    applyClass: false
                  },
                ]
              },
            ]
          }"
      >
        <ng-container caption>
          <form [formGroup]="itemTransactionForm" (ngSubmit)="itemTransactionSubmit()">
            <div class="group">
              <div class="grid">
                <div class="col-12 md:col-2">
                  <!-- <p class="headsCont heading_b16">{{ 'payment-view.code' | translate }}</p> -->
                  <p class="subHead paragraph_b16 pragraph_demd">
                    {{ warehouseTransaction.itemName }}
                  </p>
                </div>
                <div class="col-12 md:col-2">
                  <p class="subHead paragraph_b16 pragraph_demd">
                    {{ warehouseTransaction.itemCode }}
                  </p>
                </div>

                <div class="col-12 md:col-2">
                  <p class="subHead paragraph_b16 pragraph_demd">
                    {{ warehouseTransaction.warehouseName }}
                  </p>
                </div>
              </div>
            </div>
          </form>
        </ng-container>
        <ng-template #accountName let-trial>
          <div></div>
        </ng-template>
        <ng-template #accountCode let-trial>
          <div></div>
        </ng-template>
      </lib-data-table>

      <div class="footer_form">
        <form [formGroup]="itemTransactionForm" (ngSubmit)="itemTransactionSubmit()">
          <div class="group">
            <div class="grid">
              <div class="col-12 md:col-2">
                <p class="subHead paragraph_b16 pragraph_demd">
                  {{ warehouseTransaction.qtyBalance }}
                </p>
              </div>
              <div class="col-12 md:col-2">
                <p class="subHead paragraph_b16 pragraph_demd">
                  {{ warehouseTransaction.itemCost }}
                </p>
              </div>
              <div class="col-12 md:col-2">
                <p class="subHead paragraph_b16 pragraph_demd">
                  {{ warehouseTransaction.totalBalanceAmount }}
                </p>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    }

    <div id="printableTable" class="printed_tables">
      @for(warehouseTransaction of warehousesTransactionsTables; track warehouseTransaction) {
      <lib-table-print
        id="single_printed_table"
        resizableColumns="false"
        [items]="warehouseTransaction.transactions"
        className="p-datatable-gridlines"
        [tableConfigs]="{

        allowServerPagination: false,
        dataKey: 'id',
          columns: [
            {
              name: 'transaction Name',
              headerText: ('itemCardReport.transactionName' | translate),
              rowspan: '3',
              class: 'center'
            },
            {
              name: 'accountName',
              headerText: ('itemCardReport.transactionCode' | translate),
              rowspan: '3',
              class: 'center',
            },
            {
              name: 'accountName',
              headerText: ('itemCardReport.serial' | translate),
              rowspan: '3',
              class: 'center',
            },
            {
              name: 'accountName',
              headerText: ('itemCardReport.batchNo' | translate),
              rowspan: '3',
              class: 'center',
            },
            {
              name: 'accountName',
              headerText: ('itemCardReport.expiryDate' | translate),
              rowspan: '3',
              class: 'center',
            },

            {
              name: 'endingBalance',
              headerText: ('itemCardReport.in' | translate),
              colspan: '3',
              class: 'left_Balance center',
              children: [
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.QTY' | translate),
                  class: ' left_Balance debit center',
                },
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.cost' | translate),
                  class: ' left_Balance debit center',
                },
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.subTotal' | translate),
                  class: ' left_Balance debit center',
                },

              ]
            },
            {
              name: 'endingBalance',
              headerText: ('itemCardReport.out' | translate),
              colspan: '3',
              class: 'left_Balance center',
              children: [
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.QTY' | translate),
                  class: ' left_Balance debit center',
                },
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.cost' | translate),
                  class: ' left_Balance debit center',
                },
                {
                  name: 'debit',
                  headerText: ('itemCardReport.subTitles.subTotal' | translate),
                  class: ' left_Balance debit center',
                },

              ]
            },

          ]
        }"
      >
        <ng-container caption> </ng-container>
      </lib-table-print>
      }
    </div>
  </div>
</lib-page-content>
