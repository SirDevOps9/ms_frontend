<div class="journal_entry_add_page">
    <lib-bread-crumb></lib-bread-crumb>
    <div [formGroup]="fg" class="entry_header">
        <p class="title test">Please Enter journal entry Header</p>
        <div class="grid">
            <div class="col-12 md:col-3 ">
                <lib-text-input  placeholder="Reference Number" [iconUrl]="'https://static.thenounproject.com/png/101791-200.png'" formControlName="refrenceNumber">

                </lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <lib-text-input placeholder="Journal Date" type="date" formControlName="journalDate"></lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <lib-text-input placeholder="Journal Period" formControlName="periodId" [readOnly]="true">
                </lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <button (click)="openAttachments()">Attach</button>
            </div>
            <div class="col-12 md:col-12 ">
                <lib-text-input placeholder="Description" formControlName="description"></lib-text-input>
            </div>
        </div>
    </div>
    <div class="entry_table">
        <div class="card">
            <p-table [value]="fa.controls" dataKey="id" styleClass="p-datatable-gridlines p-datatable-striped" [tableStyle]="{ 'min-width': '50rem' }">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Id</th>
                        <th>Acc. Code</th>
                        <th>Acc. Name</th>
                        <th>Line Description</th>
                        <th>DB Amount</th>
                        <th>CR Amount</th>
                        <th>Currency</th>
                        <th>Rate</th>
                        <th>DB Amount Local</th>
                        <th>CR Amount Local</th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-fg let-editing="editing" let-i="rowIndex"> 
                    <tr [formGroup]="fg">
                        <td>{{fg.controls['id'].value}}</td>
                        <td [pEditableColumn]="fg.controls['account']" pEditableColumnField="fg.controls['account']">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-autoComplete formControlName="account" (onSelect)="accountSelected($event, i)" 
                                    [forceSelection]="true" [suggestions]="filteredAccounts" 
                                    #autocomplete (onFocus)="!autocomplete.value && autocomplete.show()"
                                    (completeMethod)="filterAccount($event)" field="accountCode"></p-autoComplete>
                                    <button (click)="openDialog(i)">open</button>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['account'].value?.accountCode }}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            {{ fg.controls['account'].value?.nameEn }}
                        </td>
                        <td [pEditableColumn]="fg.controls['lineDescription']" pEditableColumnField="lineDescription">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input formControlName="lineDescription"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['lineDescription'].value }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="fg.controls['debitAmount']" pEditableColumnField="debitAmount">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input formControlName="debitAmount"  type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['debitAmount'].value }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="fg.controls['creditAmount']" pEditableColumnField="creditAmount">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input formControlName="creditAmount"  type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['creditAmount'].value }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="fg.controls['currency']" pEditableColumnField="currency">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-autoComplete formControlName="currency" [forceSelection]="true" [suggestions]="fitleredCurrencies" (completeMethod)="filterCurrency($event)" field="currencyName"></p-autoComplete>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['currency'].value?.currencyName }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="fg.controls['currencyRate']" pEditableColumnField="currencyRate">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input formControlName="currencyRate"  type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ fg.controls['currencyRate'].value }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            {{ fg.controls['debitAmountLocal'].value | number:'1.0-2'}}
                        </td>

                        <td>
                            {{ fg.controls['creditAmountLocal'].value | number:'1.0-2' }}
                        </td>

                        <td>
                            <button (click)="deleteLine(i)">Delete</button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <div class="add_new">
            <button class="btn Line" (click)="addThing()">
                Add New Line
            </button>
            <button class="btn">
                Add Template
            </button>
        </div>
        <div class="paginator">
            <lib-paginator
            [totalRecords]="50"
            [first]="0"
            [rows]="10"
            ></lib-paginator>
        </div>

        <div class="btn_group">
            <button class="btn discard">
                discard
            </button>
            <button class="btn save" [disabled]="!fg.valid" (click)="save()">
                Save
            </button>
        </div>
    </div>

</div>